# Dashboard Issues & Fixes - November 7, 2025

## Issues Identified

### 1. Raw Markdown Without Styling
**Problem**: Dashboard pages were showing full markdown content but lost all the previous styling (no styled summary section, no formatted sections).

**Root Cause**: Template was rendering only the `<Content />` component without any wrapper styling or structured sections.

**Fix**: 
- Restored the styled "Executive Summary" section that wraps the summary text
- Kept the full `<Content />` component to render all markdown including "Key Themes & Insights"
- Added proper CSS styling for the summary section (background, border, spacing)
- Ensured proper spacing between header, summary, and markdown content

### 2. Missing Tags and Categories
**Problem**: Tags and categories were not showing on dashboard pages.

**Root Cause**: The source JSON file (`data/publishing/2025-11-07.json`) has empty arrays for both `tags: []` and `categories: []`.

**Status**: This is a **pipeline issue**, not a site issue. The parent NeuroHelix pipeline needs to populate these fields during report generation.

**Site Fix Applied**: Added conditional rendering so tag/category sections only show when arrays have items:
```astro
{dashboard.data.tags && dashboard.data.tags.length > 0 && (
  <div class="tag-list">...</div>
)}

{dashboard.data.categories && dashboard.data.categories.length > 0 && (
  <div class="category-list">...</div>
)}
```

### 3. Stale Dashboard Files
**Problem**: Old dashboard markdown files (e.g., `2025-11-06.md`) remained in the site even after their source JSON files were cleaned from the pipeline.

**Root Cause**: The ingest script (`scripts/ingest.mjs`) was only creating/updating markdown files but never deleting stale ones.

**Fix**: 
- Added cleanup logic to ingest script
- Script now compares markdown files against JSON files
- Removes any markdown files that don't have corresponding JSON sources
- Logs removed files with ğŸ—‘ï¸ emoji

**Verification**: Build log shows `ğŸ—‘ï¸  Removed stale file: 2025-11-06.md`

### 4. Date Mismatch Issue (User Reported)
**Problem**: User reported "the article from 2025/11/07 is tagged with November 6th, 2025, on the website"

**Status**: This was likely due to seeing the stale `2025-11-06.md` file before cleanup. Now fixed with the stale file cleanup.

## Files Modified

### 1. `/Users/pchouinard/Dev/NeuroHelix/site/src/pages/dashboards/[date].astro`
**Changes**:
- Added conditional rendering for tags and categories
- Added styled "Executive Summary" section before markdown content
- Restored category chips with yellow/amber styling (distinct from purple tag chips)
- Kept full markdown content rendering with `<Content />` component
- Updated CSS to include:
  - `.summary-section` - styled box for executive summary
  - `.category-chip` - amber-colored chips for categories
  - `.category-list` - flex layout for categories
  - Proper spacing throughout

### 2. `/Users/pchouinard/Dev/NeuroHelix/site/scripts/ingest.mjs`
**Changes**:
- Added `unlink` import from `fs/promises`
- Added cleanup logic before processing JSON files:
  ```javascript
  // Clean up stale markdown files that don't have corresponding JSON files
  const existingMarkdownFiles = await readdir(CONTENT_DIR);
  const jsonFileDates = new Set(jsonFiles.map(f => f.replace('.json', '')));
  const staleFiles = existingMarkdownFiles.filter(f => 
    f.endsWith('.md') && !jsonFileDates.has(f.replace('.md', ''))
  );
  
  for (const staleFile of staleFiles) {
    const staleFilePath = join(CONTENT_DIR, staleFile);
    await unlink(staleFilePath);
    console.log(`ğŸ—‘ï¸  Removed stale file: ${staleFile}`);
  }
  ```

## Current Status

### âœ… Fixed
1. Dashboard pages now show properly styled summary section
2. Full markdown content renders with all sections including "Key Themes & Insights"
3. Stale markdown files are automatically cleaned up during prebuild
4. Tags and categories display correctly when present (conditional rendering)
5. Date mismatch issue resolved

### âš ï¸ Pipeline Issue (Not Site Issue)
**Empty tags and categories**: The source JSON file has empty arrays. This needs to be fixed in the parent NeuroHelix pipeline:
- Location: Parent project that generates `/data/publishing/*.json` files
- Expected behavior: Pipeline should populate `tags` and `categories` arrays during report synthesis
- Current behavior: Arrays are empty in generated JSON

## Build Verification

```bash
pnpm build
```

**Output**:
```
ğŸ“¦ Starting content ingestion...
ğŸ—‘ï¸  Removed stale file: 2025-11-06.md
âœ… Ingestion complete: 1 dashboards processed
ğŸ·ï¸  Extracted 0 unique tags  # â† This will change when pipeline adds tags
ğŸ“Š Stats: 14 insights over 1 days
ğŸ” Building search index...
âœ… Search index built: 1 documents indexed
ğŸ“Š Index size: 0.02MB

generating static routes 
â–¶ src/pages/dashboards/[date].astro
  â””â”€ /dashboards/2025-11-07/index.html (+4ms) 
â–¶ src/pages/index.astro
  â””â”€ /index.html (+10ms) 

[build] 2 page(s) built in 882ms
```

## Next Steps

1. **Immediate**: The site is working correctly and ready for use
2. **Pipeline improvement needed**: Update the parent NeuroHelix pipeline to populate `tags` and `categories` arrays in the generated JSON files
3. **Testing**: When pipeline adds tags, verify they display correctly on the site (the display logic is already in place)

## Visual Design

### Dashboard Page Structure
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dashboard Title (h1, purple border) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ KPI Row (date, domains, generated)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tags (purple chips) - if present    â”‚
â”‚ Categories (amber chips) - if presentâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€ Executive Summary â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ (Styled purple-bordered box)     â”‚â”‚
â”‚ â”‚ Summary text with proper spacing â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Full Markdown Content:              â”‚
â”‚ - Key Themes & Insights             â”‚
â”‚ - Notable Developments              â”‚
â”‚ - Strategic Implications            â”‚
â”‚ - Actionable Recommendations        â”‚
â”‚ - Report Metadata                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Color Scheme
- **Tags**: Purple (#8b5cf6) - matches primary accent color
- **Categories**: Amber (#fbbf24) - provides visual distinction
- **Summary Section**: Purple border, surface background
- **Headers**: Purple accent color throughout
