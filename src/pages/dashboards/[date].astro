---
import BaseLayout from '../../layouts/BaseLayout.astro';
import KPIRow from '../../components/KPIRow.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const dashboards = await getCollection('dashboards');
  return dashboards.map((dashboard) => ({
    params: { date: dashboard.data.date },
    props: { dashboard },
  }));
}

const { dashboard } = Astro.props;
const { Content } = await dashboard.render();
---

<BaseLayout title={dashboard.data.title} description={dashboard.data.summary}>
  <div class="mb-8">
    <a href="/" class="text-primary hover:underline mb-4 inline-block">&larr; Back to Dashboards</a>
  </div>

  <article class="prose prose-invert prose-violet max-w-none">
    <h1 class="text-4xl font-bold text-neutral mb-2">{dashboard.data.title}</h1>
    
    <KPIRow 
      date={dashboard.data.date}
      generated={dashboard.data.generated}
      domains_count={dashboard.data.domains_count}
    />

    {dashboard.data.tags.length > 0 && (
      <div class="flex flex-wrap gap-2 mb-8">
        {dashboard.data.tags.map(tag => (
          <span class="text-xs px-3 py-1 rounded-full bg-primary/10 text-primary border border-primary/20">
            {tag}
          </span>
        ))}
      </div>
    )}

    <div class="bg-background border border-primary/30 rounded-lg p-6 mb-8">
      <h2 class="text-2xl font-bold text-primary mb-4">Executive Summary</h2>
      <p class="text-neutral-dark leading-relaxed">{dashboard.data.summary}</p>
    </div>

    {dashboard.data.sections.map(section => (
      <div class="bg-background border border-neutral-dark/30 rounded-lg p-6 mb-6">
        <h2 class="text-2xl font-bold text-neutral mb-4">{section.heading}</h2>
        <div class="text-neutral-dark leading-relaxed whitespace-pre-wrap">{section.content}</div>
      </div>
    ))}

    {dashboard.data.notable_developments.length > 0 && (
      <div class="bg-background border border-primary/30 rounded-lg p-6 mb-6">
        <h2 class="text-2xl font-bold text-primary mb-4">Notable Developments</h2>
        <ul class="list-disc list-inside space-y-2 text-neutral-dark">
          {dashboard.data.notable_developments.map(item => (
            <li>{item}</li>
          ))}
        </ul>
      </div>
    )}

    {dashboard.data.strategic_implications && (
      <div class="bg-background border border-neutral-dark/30 rounded-lg p-6 mb-6">
        <h2 class="text-2xl font-bold text-neutral mb-4">Strategic Implications</h2>
        <p class="text-neutral-dark leading-relaxed whitespace-pre-wrap">{dashboard.data.strategic_implications}</p>
      </div>
    )}

    {dashboard.data.recommendations.length > 0 && (
      <div class="bg-background border border-primary/30 rounded-lg p-6">
        <h2 class="text-2xl font-bold text-primary mb-4">Actionable Recommendations</h2>
        <ol class="list-decimal list-inside space-y-3 text-neutral-dark">
          {dashboard.data.recommendations.map(rec => (
            <li class="leading-relaxed">{rec}</li>
          ))}
        </ol>
      </div>
    )}
  </article>
</BaseLayout>
