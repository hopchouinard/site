---
interface Props {
  placeholder?: string;
}

const { placeholder = "Search dashboardsâ€¦" } = Astro.props;
---

<div class="search-bar">
  <div class="search-input-wrapper">
    <svg class="search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
      <path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM18 18l-4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <input
      type="text"
      id="dashboard-search"
      placeholder={placeholder}
      aria-label="Search dashboards"
      autocomplete="off"
    />
    <kbd class="keyboard-hint">/</kbd>
  </div>
  <div id="search-results-count" class="results-count" aria-live="polite" aria-atomic="true"></div>
</div>

<script>
  let debounceTimer: number;
  
  document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.getElementById('dashboard-search') as HTMLInputElement;
    
    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        clearTimeout(debounceTimer);
        debounceTimer = window.setTimeout(() => {
          const query = (e.target as HTMLInputElement).value;
          window.dispatchEvent(new CustomEvent('search-query-change', {
            detail: { query }
          }));
        }, 200); // 200ms debounce
      });
      
      // Keyboard shortcut: focus on /
      document.addEventListener('keydown', (e) => {
        if (e.key === '/' && document.activeElement !== searchInput) {
          e.preventDefault();
          searchInput.focus();
        }
      });
    }
  });
</script>

<style>
  .search-bar {
    margin: var(--space-6) 0;
  }
  
  .search-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    max-width: 600px;
  }
  
  .search-icon {
    position: absolute;
    left: var(--space-3);
    color: var(--color-text-muted);
    pointer-events: none;
  }
  
  input {
    width: 100%;
    padding: var(--space-3) var(--space-12) var(--space-3) var(--space-10);
    background: var(--color-surface);
    border: 1px solid rgba(139, 92, 246, 0.2);
    border-radius: var(--radius-md);
    color: var(--color-text-primary);
    font-size: 1rem;
  }
  
  input:focus {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
  }
  
  .keyboard-hint {
    position: absolute;
    right: var(--space-3);
    padding: 2px 6px;
    background: rgba(139, 92, 246, 0.1);
    border: 1px solid rgba(139, 92, 246, 0.3);
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    color: var(--color-text-muted);
  }
  
  .results-count {
    margin-top: var(--space-2);
    font-size: 0.875rem;
    color: var(--color-text-muted);
  }
</style>
